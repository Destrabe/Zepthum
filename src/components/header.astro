---
import "../styles/header.css";
const apiUrl = import.meta.env.PUBLIC_API_URL;
---

<header>
  <div class="left">
    <div class="menu-container">
      <div class="menu" id="menu">
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
    <div class="brand">
      <img src="/assets/svg/logo_tem.svg" alt="icon" class="logo" />
      <span class="name">empresa</span>
    </div>
  </div>

  <div class="right">
    <a href="#" class="icons-header">
      <img src="/assets/svg/notifications.svg" alt="notifications" />
    </a>
    <div class="separator"></div>
    <div class="profile-dropdown">
      <div class="profile-info" id="profileToggle">
        <span class="greeting">Hola, <strong>Marco Fabian</strong></span>
        <img src="/assets/images/kirby.webp" alt="user" class="user" />
        <img
          src="/assets/svg/arrow-down.svg"
          alt="arrow"
          class="arrow-icon"
          id="arrowIcon"
        />
      </div>

      <div class="dropdown-menu" id="dropdownMenu">
        <button id="logout" class="logout-btn">
          <img src="/assets/svg/logout.svg" alt="logout" />
          Cerrar sesi√≥n
        </button>
      </div>
    </div>
  </div>

  <script type="module">
    import userService from "/scripts/userService.js";

    document.addEventListener("DOMContentLoaded", () => {
      const toggle = document.getElementById("profileToggle");
      const menu = document.getElementById("dropdownMenu");
      const arrow = document.getElementById("arrowIcon");
      const logout = document.getElementById("logout");

      const arrowDown = "/assets/svg/arrow-down.svg";
      const arrowUp = "/assets/svg/arrow-up.svg";

      toggle.addEventListener("click", () => {
        const isOpen = menu.classList.toggle("show");
        arrow.src = isOpen ? arrowUp : arrowDown;
      });

      document.addEventListener("click", (e) => {
        if (!toggle.contains(e.target) && !menu.contains(e.target)) {
          menu.classList.remove("show");
          arrow.src = arrowDown;
        }
      });

      logout.addEventListener("click", (event) => {
        event.preventDefault();
        userService
          .logout(apiUrl)
          .then(() => {
            window.location.href = "/login";
          })
          .catch((error) => {
            console.error("Error during logout:", error);
          });
      });
    });
  </script>
</header>
